<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xiaomi Multi-Engineer Portal</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root { --xiaomi-orange: #ff6700; }
        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--xiaomi-orange); }
        .login-card { width: 350px; border-radius: 20px; border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .navbar-custom { background: #212529; color: white; padding: 10px 20px; border-radius: 8px; margin-bottom: 20px; }
        .stat-card { border: none; border-radius: 15px; color: white; padding: 20px; }
        .section-box { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn-xiaomi { background: var(--xiaomi-orange); color: white; font-weight: bold; border-radius: 10px; border: none; padding: 12px; }
        .engineer-tag { font-size: 0.7rem; background: #eee; padding: 2px 8px; border-radius: 10px; color: #555; }
    </style>
</head>
<body>

<div id="loginPage" class="login-container">
    <div class="card login-card p-4 text-center">
        <h3 class="fw-bold" style="color: var(--xiaomi-orange);">Xiaomi Portal</h3>
        <p class="text-muted">Apni ID ka Password Dalein</p>
        <input type="password" id="passInput" class="form-control form-control-lg text-center mb-3" placeholder="••••••••">
        <button onclick="handleLogin()" class="btn btn-xiaomi w-100">Login</button>
    </div>
</div>

<div id="mainApp" class="container-fluid p-4" style="display: none;">
    <nav class="navbar-custom d-flex justify-content-between align-items-center shadow">
        <h5 class="mb-0">Xiaomi Service Dashboard</h5>
        <div>
            <span id="userDisplayName" class="badge bg-light text-dark p-2 me-2"></span>
            <button onclick="location.reload()" class="btn btn-outline-light btn-sm">Logout</button>
        </div>
    </nav>

    <div id="adminDashboard" class="row g-3 mb-4" style="display: none;">
        <div class="col-md-3 col-6"><div class="stat-card bg-primary"><h6>Calls</h6><h2 id="statCalls">0</h2></div></div>
        <div class="col-md-3 col-6"><div class="stat-card bg-success"><h6>Total ₹</h6><h2 id="statColl">0</h2></div></div>
        <div class="col-md-3 col-6"><div class="stat-card bg-danger"><h6>Expense</h6><h2 id="statExp">0</h2></div></div>
        <div class="col-md-3 col-6"><div class="stat-card bg-dark"><h6>Profit</h6><h2 id="statProfit">0</h2></div></div>
    </div>

    <div class="row">
        <div class="col-lg-4">
            <div class="section-box">
                <h5 class="fw-bold border-bottom pb-2 mb-3">Add Entry</h5>
                <input type="text" id="job_id" class="form-control mb-2" placeholder="Job Sheet No.">
                <input type="text" id="issue" class="form-control mb-2" placeholder="Problem">
                <textarea id="solution" class="form-control mb-2" placeholder="Solution Given"></textarea>
                <div class="row g-2 mb-3">
                    <div class="col-7"><input type="number" id="call_amt" class="form-control" placeholder="Amount ₹"></div>
                    <div class="col-5">
                        <select id="pay_mode" class="form-select">
                            <option value="Cash">Cash</option>
                            <option value="UPI">UPI</option>
                        </select>
                    </div>
                </div>
                <button onclick="submitEntry()" class="btn btn-xiaomi w-100">Save Entry</button>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="section-box">
                <h5 class="fw-bold border-bottom pb-2 mb-3">Live Reports (Today)</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr class="small"><th>Engineer</th><th>Job ID</th><th>Problem</th><th>Payment</th><th>Action</th></tr>
                        </thead>
                        <tbody id="tableBody" class="small"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBQ893qaUY52PE2-gQGDPV87RI4h5pssqk",
        authDomain: "xiaomi-service-8f70a.firebaseapp.com",
        databaseURL: "https://xiaomi-service-8f70a-default-rtdb.firebaseio.com",
        projectId: "xiaomi-service-8f70a",
        storageBucket: "xiaomi-service-8f70a.firebasestorage.app",
        messagingSenderId: "349726895573",
        appId: "1:349726895573:web:d8d7938f94980207b6615c"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const today = new Date().toISOString().split('T')[0];
    
    let activeUser = "";
    let userRole = "";

    // Multi-User Passwords
    const users = {
        "Nausin123": { name: "Nausin Mansuri", role: "Engineer" },
        "vikram123": { name: "Vikram", role: "Engineer" },
        "imran123": { name: "Imran", role: "Engineer" },
        "admin786": { name: "Admin (Owner)", role: "Admin" }
    };

    function handleLogin() {
        const pass = document.getElementById('passInput').value;
        if(users[pass]) {
            activeUser = users[pass].name;
            userRole = users[pass].role;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userDisplayName').innerText = "Hello, " + activeUser;
            
            if(userRole === 'Admin') document.getElementById('adminDashboard').style.display = 'flex';
            syncData();
        } else {
            alert("Wrong Password!");
        }
    }

    function submitEntry() {
        const id = document.getElementById('job_id').value;
        const amt = parseFloat(document.getElementById('call_amt').value) || 0;
        if(!id || !amt) return alert("Pehle details bhariye");

        db.ref('reports/' + today + '/calls').push({
            engineer: activeUser,
            job_id: id,
            iss: document.getElementById('issue').value,
            sol: document.getElementById('solution').value,
            amt: amt,
            mode: document.getElementById('pay_mode').value,
            time: new Date().toLocaleTimeString()
        });
        
        alert("Saved for " + activeUser);
        ['job_id','issue','solution','call_amt'].forEach(i => document.getElementById(i).value = '');
    }

    function syncData() {
        db.ref('reports/' + today).on('value', (snap) => {
            const data = snap.val();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = "";
            let tC = 0, count = 0;

            if(data?.calls) {
                Object.keys(data.calls).forEach(key => {
                    const c = data.calls[key];
                    tC += c.amt; count++;
                    tbody.innerHTML += `<tr>
                        <td><span class="fw-bold">${c.engineer}</span><br><small class="text-muted">${c.time}</small></td>
                        <td>${c.job_id}</td>
                        <td>${c.iss}</td>
                        <td class="text-success fw-bold">₹${c.amt} (${c.mode})</td>
                        <td>${userRole === 'Admin' ? `<button onclick="delItem('${key}')" class="btn btn-sm text-danger">×</button>` : 'Locked'}</td>
                    </tr>`;
                });
            }
            document.getElementById('statCalls').innerText = count;
            document.getElementById('statColl').innerText = "₹" + tC;
            document.getElementById('statProfit').innerText = "₹" + tC;
        });
    }

    function delItem(key) {
        if(confirm("Delete this entry?")) db.ref('reports/' + today + '/calls/' + key).remove();
    }
</script>
</body>
</html>
