<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xiaomi Cloud Service Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .login-screen { height: 100vh; display: flex; align-items: center; justify-content: center; background: #ff6700; }
        .app-content { display: none; }
        .main-card { max-width: 500px; margin: 20px auto; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: none; }
        .brand-header { background: #ff6700; color: white; padding: 15px; text-align: center; border-radius: 15px 15px 0 0; }
        .section-box { background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #dee2e6; }
        .btn-xiaomi { background: #ff6700; color: white; width: 100%; font-weight: bold; border: none; padding: 12px; }
    </style>
</head>
<body>

<div id="loginScreen" class="login-screen">
    <div class="card p-4 shadow" style="width: 320px;">
        <h4 class="text-center mb-4">Xiaomi Login</h4>
        <input type="password" id="passInput" class="form-control mb-3" placeholder="Enter Password">
        <button onclick="checkLogin()" class="btn btn-warning w-100">Unlock Portal</button>
    </div>
</div>

<div id="appContent" class="app-content container">
    <div class="card main-card">
        <div class="brand-header">
            <h4 id="portalTitle">Xiaomi Service Portal</h4>
            <div id="userRole" class="badge bg-light text-dark"></div>
        </div>

        <div class="card-body">
            <div id="engForm" class="section-box shadow-sm">
                <input type="text" id="job_id" class="form-control mb-2" placeholder="Job Sheet No.">
                <input type="text" id="issue" class="form-control mb-2" placeholder="Issue">
                <textarea id="solution" class="form-control mb-2" placeholder="Solution Given"></textarea>
                <div class="row g-2 mb-3">
                    <div class="col-7"><input type="number" id="call_amt" class="form-control" placeholder="Amount (₹)"></div>
                    <div class="col-5">
                        <select id="pay_mode" class="form-select">
                            <option value="Cash">Cash</option>
                            <option value="UPI">UPI</option>
                        </select>
                    </div>
                </div>
                <button onclick="saveToCloud()" class="btn btn-xiaomi">Submit to Cloud</button>
            </div>

            <div id="adminView" class="section-box shadow-sm mt-3">
                <h6 class="text-primary fw-bold border-bottom pb-2">Live Cloud Records</h6>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead><tr><th>Job ID</th><th>Amt</th><th>Mode</th></tr></thead>
                        <tbody id="liveTableBody"></tbody>
                    </table>
                </div>
                <div class="p-2 bg-light text-center fw-bold rounded">
                    Today's Total: <span id="total_cash" class="text-success">₹0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 1. YOUR FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyBQ893qaUY52PE2-gQGDPV87RI4h5pssqk",
        authDomain: "xiaomi-service-8f70a.firebaseapp.com",
        databaseURL: "https://xiaomi-service-8f70a-default-rtdb.firebaseio.com",
        projectId: "xiaomi-service-8f70a",
        storageBucket: "xiaomi-service-8f70a.firebasestorage.app",
        messagingSenderId: "349726895573",
        appId: "1:349726895573:web:d8d7938f94980207b6615c"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const today = new Date().toISOString().split('T')[0];

    // 2. LOGIN LOGIC
    function checkLogin() {
        const pass = document.getElementById('passInput').value;
        if(pass === 'xiaomi123') {
            showPortal('Engineer');
        } else if(pass === 'admin786') {
            showPortal('Admin');
        } else {
            alert("Wrong Password!");
        }
    }

    function showPortal(role) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('appContent').style.display = 'block';
        document.getElementById('userRole').innerText = "Logged in as: " + role;
        
        if(role === 'Engineer') {
            document.getElementById('adminView').style.display = 'none';
        }
    }

    // 3. SAVE DATA
    function saveToCloud() {
        const id = document.getElementById('job_id').value;
        const amt = parseFloat(document.getElementById('call_amt').value) || 0;

        if(!id || !amt) return alert("Details bhariye!");

        database.ref('reports/' + today + '/calls').push({
            job_id: id,
            issue: document.getElementById('issue').value,
            solution: document.getElementById('solution').value,
            amount: amt,
            mode: document.getElementById('pay_mode').value
        });

        alert("Data Cloud par save ho gaya!");
        ['job_id','issue','solution','call_amt'].forEach(f => document.getElementById(f).value = '');
    }

    // 4. LOAD DATA (REALTIME)
    database.ref('reports/' + today + '/calls').on('value', (snap) => {
        const tbody = document.getElementById('liveTableBody');
        tbody.innerHTML = "";
        let total = 0;
        snap.forEach((child) => {
            const d = child.val();
            total += d.amount;
            tbody.innerHTML += `<tr><td>${d.job_id}</td><td>₹${d.amount}</td><td>${d.mode}</td></tr>`;
        });
        document.getElementById('total_cash').innerText = "₹" + total;
    });
</script>

</body>
</html>